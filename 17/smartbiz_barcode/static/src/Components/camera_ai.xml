<!-- templates.xml: replace entire template my_camera.CameraAI -->
<t t-name="my_camera.CameraAI">
  <div class="s_cam_ai_modal-overlay">
    <div class="s_cam_ai_modal-content">
      <button class="s_cam_ai_close-btn fa-solid fa-xmark" t-on-click="close" title="Close">×</button>

      <!-- CAMERA -->
      <div class="s_cam_ai_cam-area">
        <video
          t-ref="video"
          class="s_cam_ai_video-preview"
          autoplay="autoplay"
          playsinline="playsinline"
        />
        <div class="s_cam_ai_toolbar">
          <button class="s_cam_ai_capture-btn" t-if="!state.busy" t-on-click="takePhoto">Capture</button>
          <div class="s_cam_ai_loading" t-if="state.busy">Processing…</div>
        </div>
      </div>

      <!-- EXPECTED ITEMS TABLE -->
      <div class="s_cam_ai_expected-panel">
        <div class="s_cam_ai_panel-title">Expected Items</div>

        <div class="s_cam_ai_expected-header">
          <div class="s_cam_ai_col-code">Code</div>
          <div class="s_cam_ai_col-name">Name</div>
          <div class="s_cam_ai_col-qty-need">Required</div>
          <div class="s_cam_ai_col-qty-got">Received</div>
        </div>

        <div class="s_cam_ai_expected-scroll">
          <t t-foreach="state.expected" t-as="it" t-key="it.ma_part">
            <div class="s_cam_ai_expected-row" t-on-click="() => this.openEditor(it.ma_part)">
              <div class="s_cam_ai_col-code" t-esc="it.ma_part"/>
              <div class="s_cam_ai_col-name s_cam_ai_ellipsis" t-esc="it.ten"/>
              <div class="s_cam_ai_col-qty-need" t-esc="it.so_yeu_cau"/>
              <div class="s_cam_ai_col-qty-got" t-esc="state.detected_map[it.ma_part] ?? 0"/>
            </div>
          </t>
        </div>
      </div>

      <!-- RAW LOG (optional) -->
      <pre class="s_cam_ai_result" t-if="state.rawAnswer"><t t-esc="state.rawAnswer"/></pre>

      <!-- ACTION BAR -->
      <div class="s_cam_ai_modal-actions">
        <button class="s_cam_ai_btn" t-on-click="cancelAll">Cancel</button>
        <div class="s_cam_ai_spacer"></div>
        <button class="s_cam_ai_btn-primary" t-on-click="confirmAndSend">Confirm</button>
      </div>
    </div>
  </div>

  <!-- EDITOR: per-product capture lines -->
  <t t-if="state.editor.open">
    <div class="s_cam_ai_editor-overlay">
      <div class="s_cam_ai_editor-content">
        <div class="s_cam_ai_editor-header">
          <div class="s_cam_ai_editor-title">
            Adjust Received — <span t-esc="state.editor.ma_part"/>
          </div>
          <button class="s_cam_ai_editor-close" t-on-click="cancelEditor">×</button>
        </div>

        <div class="s_cam_ai_editor-table-head">
          <div class="s_cam_ai_col-cap">Capture</div>
          <div class="s_cam_ai_col-name">Name</div>
          <div class="s_cam_ai_col-qty">Qty</div>
          <div class="s_cam_ai_col-act">Action</div>
        </div>

        <div class="s_cam_ai_editor-table-scroll">
          <t t-foreach="state.editor.tempLines" t-as="ln" t-key="ln._id">
            <div class="s_cam_ai_editor-row">
              <div class="s_cam_ai_col-cap" t-esc="ln.capture_label"/>
              <div class="s_cam_ai_col-name s_cam_ai_ellipsis" t-esc="ln.ten"/>
              <div class="s_cam_ai_col-qty">
                <input type="number" min="0" step="1" t-model.number="ln.so_luong"/>
              </div>
              <div class="s_cam_ai_col-act">
                <button class="s_cam_ai_btn-danger" t-on-click="() => this.removeEditorLine(ln._id)">Delete</button>
              </div>
            </div>
          </t>
        </div>

        <div class="s_cam_ai_editor-actions">
          <button class="s_cam_ai_btn" t-on-click="addEditorLine">Add Row</button>
          <div class="s_cam_ai_spacer"></div>
          <div class="s_cam_ai_editor-total">Total: <span t-esc="editorTotal()"/></div>
          <button class="s_cam_ai_btn-primary" t-on-click="saveEditor">Save</button>
        </div>
      </div>
    </div>
  </t>
</t>
