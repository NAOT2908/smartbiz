<templates>
    <t t-name="WorkOrder">
        <div class="main work-order">
            <div class="work-order-header">
                <nav class="work-order_nav">
                    <nav class="work-order_nav_left">
                        <button t-on-click="exit" class="work-order_nav-link">
                            <i class="oi oi-chevron-left" />
                        </button>
                        <div class="work-order_nav_title">
                            <t t-esc="state.title" />
                        </div>
                        
                    </nav>
                    <nav class="work-order_nav_right">
                        <div
                            class="work-order_search-box" t-if="state.search">
                            <input class="work-order_search-input" t-on-input="handleInput"
                                t-att-value="state.searchInput"
                                placeholder="Tìm kiếm" />
                        </div>
                        <div class="work-order_nav-link" t-on-click="searchClick">
                            <i class="fa fa-search" />
                        </div>
                        <div class="work-order_nav-link" t-on-click="openManualScanner">
                            <i class="fa fa-barcode" />
                        </div>
                        <div class="work-order_nav-link" t-on-click="toggleMenu">
                            <i class="fa fa-bars"></i>
                        </div>
                    </nav>
                </nav>
            </div>
            <div
                t-att-class="{
            'workorder-overlay': true,
            'open': state.menuVisible,
            'close': !state.menuVisible
        }"
                t-on-click="toggleMenu"></div>

            <div
                t-att-class="{
            'workorder': true,
            'workorder-open': state.menuVisible,
            'workorder-close': !state.menuVisible
        }">
                <div class="workorder-header">
                    <div>
                        <t t-esc="state.username" />
                    </div>
                    <span class="close-icon" t-on-click="toggleMenu">
                        <i class="fa fa-times"></i>
                    </span>
                </div>
                <div class="workorder-items">
                    <button t-on-click="() => this.openSelector(1)">In phiếu kiểm kê</button>
                    <button t-on-click="() => this.openSelector(8)">In hàng loạt</button>
                    <button t-on-click="cancelOrder">ZZZ</button>
                </div>
            </div>
            <div t-if="state.view === 'WorkOrders'" class="work-order-list">
                <WorkOrderList
                    t-props="{
                        workOrders: state.workOrders,
                        selectWorkOrder: selectWorkOrder.bind(this),
                        selectedWorkOrder: state.selectedWorkOrder,
                        searchQuery: state.searchQuery,
                        searchWorkOrders: searchWorkOrders.bind(this),
                        stateMapping: stateMapping
                    }"
                />
            </div>
            <div t-if="state.view === 'WorkOrderDetail'" class="work-order-right">
                <div class="work-order-detail">
                    <WorkOrderDetail
                        t-if="true"
                        t-props="{
                            workOrder: state.selectedWorkOrder,
                            startWorkOrder: startWorkOrder.bind(this),
                            pauseWorkOrder: pauseWorkOrder.bind(this),
                            stopWorkOrder: stopWorkOrder.bind(this),
                            showPause:state.showPause,
                            showStart:state.showStart,
                            showStop:state.showStop,
                            activeButton: state.activeButton,
                            timer: state.timer
                        }"
                    />
                </div>
                <div class="components-container">
                    <div class="components-header">Danh sách Cấu phần</div>
                    <div class="components-list-wrapper">
                        <ComponentList
                            t-props="{
                                    components: state.components,
                                    selectComponent: selectComponent.bind(this),
                                    selectedComponent: state.selectedComponent,
                                    closeKeypad:closeKeypad,
                                    select:select
                                }"
                        />
                    </div>

                </div>
            </div>
            <div t-if="state.view === 'ActionDetail'" class="s_detail_componentlist">
                <div class="components-right">
                    <div class="action-detail">
                        <ActionDetail
                            t-if="true"
                            t-props="{
                                    component: state.selectedComponent,
                                    okAction: okAction.bind(this),
                                    ngAction: ngAction.bind(this),
                                    updateQuantity:updateQuantity.bind(this),
                                    printLabel: printLabel.bind(this),
                                    showOK:state.showOK,
                                    showNG:state.showNG,
                                    showPrint:state.showPrint,
                                    openPDF: openPDF.bind(this),
                                    showKeypad: showKeypad
                                }"
                        />
                    </div>
                    <div t-if="state.showPDF" class="action-document">
                        <ActionDocument
                            t-if="state.document"
                            t-props="{ document: state.document,
                                            closePDF: closePDF
                                 }"
                        />
                    </div>
                </div>
            </div>
            <div t-if="state.view === 'ScanWorkCenter'">
                <div class="scan-info">
                    <h2>Quét Khu vực sản xuất và người thực hiện</h2>
                    <!-- Khu vực sản xuất -->
                    <div class="form-group">
                        <label for="area">Khu vực sản xuất: </label>
                        <span id="area" 
                            class="form-control" 
                            t-att-title="state.productionArea" 
                            t-on-focus="setScanTarget('productionArea')" 
                            t-esc="state.workcentername" 
                            placeholder="Nhập khu vực sản xuất" />
                    </div>

                    <!-- Người dùng -->
                    <div class="form-group">
                        <label for="username">Người thực hiện: </label>
                        <span id="username" 
                            class="form-control" 
                            t-att-title="state.username" 
                            t-on-focus="setScanTarget('username')" 
                            t-esc="state.username" 
                            placeholder="Nhập tên người dùng" />
                    </div>

                    <div class="scan-button">
                        <button class="scan-btn " t-on-click="openWorkorder">Xác nhận</button>
                        <button class="scan-btn " t-on-click="Resetscan">Reset</button>
                    </div>
                </div>
            </div>
        </div>
        <KeyPads t-if="state.showkeypad" t-props="{detailMoveLine:state.component,keyClick:keyClick,keyPadTitle:state.keyPadTitle,currentQuantityField: state.currentQuantityField}"/>
    </t>

    <t t-name="WorkOrderList" >
        <div class="section_header">Danh sách Work Order</div>
        <div class="workorder-items">
            <div
                t-foreach="props.workOrders"
                t-as="order"
                t-key="order.id"
                t-on-click="() => props.selectWorkOrder(order.id)"
                t-att-class="{selected: order.id === props.selectedWorkOrder?.id}"
            >
                <div class="item">
                    <div class="item-content" >
                        <div style="font-size: 20px;font-weight: bold;" t-esc="order.name" />
                        <div ><span t-att-class="'state-label ' + (order.state === 'progress' ? 'state-progress' : 
                                        order.state === 'pending' ? 'state-pending' : 
                                        order.state === 'ready' ? 'state-ready' : 
                                        order.state === 'waiting' ? 'state-waiting' : 'state-default')"  t-esc="props.stateMapping[order?.state] || order?.state" /></div>
                    </div>
                    <div>Lô sản xuất: <span t-esc="order.production_name" /></div>
                    <div>Sản phẩm: <span t-esc="order.product_name" /></div>
                    <div>Số lượng: <span t-esc="order.quantity" /></div>
                    
                </div>
            </div>
        </div>
    </t>

    <t t-name="WorkOrderDetail">
        <div>
            <div class="section_header">Chi tiết Lệnh : <t t-esc="props.workOrder?.production_name" /></div>
            <div class="s_work_order_container">
                <table class="s_work_order_table">
                    <tbody>
                        <tr>
                            <td class="s_work_order_label">Sản phẩm:</td>
                            <td class="s_work_order_value" t-esc="props.workOrder?.product_name || '-'"></td>
                        </tr>
                        <tr>
                            <td class="s_work_order_label">SL(Còn/HT/YC):</td>
                            <td class="s_work_order_value">
                                <span  t-esc="props.workOrder?.qty_remaining || '-'"></span>
                                <span > /</span>
                                <span t-esc="props.workOrder?.qty_produced || '-'"></span>
                                <span > /</span>
                                <span t-esc="props.workOrder?.qty_production || '-'"> </span>
                                <span style="margin-left: 5px" t-esc="props.workOrder?.product_uom || '-'"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="s_work_order_label">Thời gian(+/TT/DK):</td>
                            <td class="s_work_order_value">
                                <!-- <t t-esc="props.timer || '00:00:00'"></t>
                                <span > /</span> -->
                                <t t-esc="floatToTimeString(props.workOrder?.duration || '-')"></t>
                                <span > /</span>
                                <t t-esc="floatToTimeString(props.workOrder?.duration_expected || '-')"></t>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="s_work_order_right">
                    <button t-on-click="props.startWorkOrder" class="s_work_order_button"
                        t-if="props.showStart"
                        t-att-class="props.activeButton === 'start' ? 'active' : ''"
                        >
                        <i class="fa fa-play"></i>
                        <span class="button-label">Bắt đầu</span>
                    </button>
                    <button t-on-click="props.pauseWorkOrder" class="s_work_order_button"
                        t-if="props.showPause"
                        t-att-class="props.activeButton === 'pause' ? 'active' : ''"
                        >
                        <i class="fa fa-pause"></i>
                        <span class="button-label">Tạm dừng</span>
                    </button>
                    <button t-on-click="props.stopWorkOrder" class="s_work_order_button"
                        t-if="props.showStop"
                        t-att-class="props.activeButton === 'stop' ? 'active' : ''"
                        >
                        <i class="fa fa-stop"></i>
                        <span class="button-label">Dừng</span>
                    </button>
                </div>
            </div>
        </div>

    </t>

    <t t-name="ComponentList">
        <div class="components-list">
            <div
                t-foreach="props.components"
                t-as="component"
                t-key="component.id"
                t-att-class="{selected: component.id === props.selectedComponent?.id}"
                t-on-click="() => props.select(component.id)"
            >
                <div class="component-item">
                    <div class="component-info">
                        <div class="name" style="font-size: 20px;font-weight: bold;" t-esc="component.name"></div>
                        <div class="quantity">Số lượng: <t t-esc="component.quantity" /></div>
                        <div class="quantity">Số lượng đạt: <t t-esc="component.ok_quantity" /></div>
                        <div class="quantity">Số lượng NG: <t t-esc="component.ng_quantity" /></div>
                    </div>
                    <div class="component-actions">
                        <!-- <button
                            class="action-btn ok-btn"
                            t-on-click="() => props.showKeypad({title: 'Số lượng ĐẠT', color: 'green'},component)"
                        >
                            <i class="fa fa-check"></i>
                        </button>
                        <button
                            class="action-btn ng-btn"
                            t-on-click="() => props.showKeypad({title: 'Số lượng KO ĐẠT', color: 'red'},component)"
                        >
                            <i class="fa fa-times"></i>
                        </button> -->
                        <button
                            class="action-btn details-btn"
                            t-on-click="() => props.selectComponent(component)"
                        >
                            <i class="fa fa-info-circle"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </t>

    <t t-name="ActionDetail">
        <div>
            <div class="section_header">Chi tiết SP</div>
            <div class="s_action_detail_container">
                <div class="s_action_detail_content">
                    <div class="s_detail_row">
                        <span class="s_detail_label">Sản phẩm:</span>
                        <span class="s_detail_value"
                            t-esc="props.component?.product_name || props.component?.name || '-'" />
                    </div>
                    <div class="s_detail_row">
                        <span class="s_detail_label">Lô sản xuất:</span>
                        <span class="s_detail_value" t-esc="props.component?.lot_name || '-'" />
                    </div>
                    <div class="s_detail_row">
                        <span class="s_detail_label">Yêu cầu/Hoàn thành:</span>
                        <span class="s_detail_value">
                            <t t-esc="props.component?.quantity || '-'" /> / <t
                                t-esc="props.component?.produced_quantity || '-'" />
                        </span>
                    </div>
                    <div class="s_detail_row">
                        <span class="s_detail_label">Đạt:</span>
                        <span class="s_detail_value" t-esc="props.component?.ok_quantity || '-'" />
                    </div>
                    <div class="s_detail_row">
                        <span class="s_detail_label">NG:</span>
                        <span class="s_detail_value" t-esc="props.component?.ng_quantity || '-'" />
                    </div>
                </div>
                <div class="s_action_buttons">
                    <div class="s_action_detail_buttons" t-if="props.showOK">
                        <div class="s_increment_buttons">
                            <button class="s_ok_plus_button"
                                t-on-click="()=>props.updateQuantity('ok','+')">
                                <i class="fa fa-plus"></i>
                            </button>
                            <div t-on-click="() => props.showKeypad({title: 'Số lượng ĐẠT', color: '#11B714'},props.component, 'ok')" t-esc="props.component?.producing_ok_quantity || '0'" />
                            <button class="s_ok_minus_button"
                                t-on-click="()=>props.updateQuantity('ok','-')">
                                <i class="fa fa-minus"></i>
                            </button>

                        </div>
                        <button t-on-click="props.okAction" class="s_action_ok_button">
                            OK
                        </button>
                    </div>
                    <div class="s_action_detail_buttons" t-if="props.showNG">
                        <div class="s_increment_buttons">
                            <button class="s_ng_plus_button"
                                t-on-click="()=>props.updateQuantity('ng','+')">
                                <i class="fa fa-plus"></i>
                            </button>
                            <div t-on-click="() => props.showKeypad({title: 'Số lượng KO ĐẠT', color: '#E6960D'},props.component, 'ng')" t-esc="props.component?.producing_ng_quantity || '0'" />
                            <button class="s_ng_minus_button"
                                t-on-click="()=>props.updateQuantity('ng','-')">
                                <i class="fa fa-minus"></i>
                            </button>

                        </div>
                        <button t-on-click="props.ngAction" class="s_action_ng_button">
                            NG
                        </button>
                    </div>

                    <div class="s_action_detail_buttons" t-if="props.showPrint">
                        <button class="s_action_print_button" t-on-click="()=>props.printLabel()">
                            <i class="fa fa-print fa-2x"></i>
                        </button>
                        <button class="s_action_pdf_button" t-on-click="() => props.openPDF()">
                            <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>
        <!-- <KeyPads t-if="props.showKeypad" t-props="{detailMoveLine:props.component,keyClick:keyClick,keyPadTitle:state.keyPadTitle}"/> -->

    </t>
    <t t-name="ActionDocument">
        <div class="document-container">
            <button class="close-pdf-btn" t-on-click="props.closePDF">×</button>
            <!-- <div class="section_header">Tài liệu</div> -->
            <div class="document-content">
                <t t-if="props.document.type === 'pdf'">
                    <iframe t-att-src="props.document.url" class="pdf-iframe"></iframe>
                </t>
            </div>
        </div>
    </t>



</templates>